---
alwaysApply: true
---
# Static Website Generation Logic

## Overview

Generate static HTML/CSS/JavaScript files from music source files.

## Directory Structure

* **Source templates**: `src/web/` - HTML templates and source files
* **Cache**: `src/web/tracks/` - Generated audio/images (cache, skip if exists)
* **Output**: `web/` - Final static files (copied from `src/web/tracks/` + generated HTML/CSS/JS). The content of this folder is disposable and will be regenerated on each run

## Process Flow

### Discover Tracks

* Scan `music/` directory recursively
* Find all day folders containing `track.yml`
* Ignore day folders without `track.yml`
* Extract date from folder path: `music/a{year}/a{month}_{name}/a{day}_{name}/`
  * Example: `music/a2024/a11_nov/a05_cloven_hoofed/` → date: 2024-11-05

### Process Each Track

#### Audio Processing

* Check if `src/web/tracks/{url}/audio/track.mp3` exists → skip if found
* Locate `*_mix.wav` in track directory
* **Error**: If missing or multiple matches
* Convert WAV → MP3 using `ffmpeg` via `subprocess`
* Save to: `src/web/tracks/{url}/audio/track.mp3`

#### Image Processing

* Check if `src/web/tracks/{url}/images/cover.jpg` exists → skip if found
* Locate `*_cover.jpg` in track directory
* **Error**: If missing or multiple matches
* Copy to: `src/web/tracks/{url}/images/cover.jpg`
* Generate thumbnail (600px width, constant in Python script)
* Save to: `src/web/tracks/{url}/images/cover_600.jpg`

### Copy Cache to Output

* Copy entire `src/web/tracks/` directory to `web/`

### Home page

* Generate `web/index.html` using template at `src/web/layout/index.html`.
* Template contains: `<html>`, `<head>`, `<body>` and a body content placeholder `{{ body }}`.
* Replace `{{ body }}` with grid of track thumbnails `cover_600.jpg` (responsive, no margins).
* Responsive CSS grid: more on wide screens, fewer on narrow (1-2 on phones).
* Click thumbnail → open track page.

### Output Files

* `web/js/*.js` - JavaScript
* `web/css/*.css` - Stylesheets
* `web/index.html` - Main page
* `web/{url}/index.html` - Track page
* `web/{url}/audio/track.mp3` - Track audio
* `web/{url}/images/cover.jpg` - Track cover
* `web/{url}/images/cover_600.jpg` - Track cover thumbnail
